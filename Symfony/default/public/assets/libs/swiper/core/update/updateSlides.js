import{elementChildren,elementOuterSize,elementStyle,setCSSProperty}from"../../shared/utils.js";export default function updateSlides(){const e=this;function t(t){return e.isHorizontal()?t:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[t]}function i(e,i){return parseFloat(e.getPropertyValue(t(i))||0)}const s=e.params,{wrapperEl:r,slidesEl:l,size:n,rtlTranslate:o,wrongRTL:a}=e,d=e.virtual&&s.virtual.enabled,f=d?e.virtual.slides.length:e.slides.length,p=elementChildren(l,`.${e.params.slideClass}, swiper-slide`),h=d?e.virtual.slides.length:p.length;let g=[];const c=[],u=[];let m=s.slidesOffsetBefore;"function"==typeof m&&(m=s.slidesOffsetBefore.call(e));let S=s.slidesOffsetAfter;"function"==typeof S&&(S=s.slidesOffsetAfter.call(e));const y=e.snapGrid.length,w=e.slidesGrid.length;let v=s.spaceBetween,z=-m,G=0,P=0;if(void 0===n)return;"string"==typeof v&&v.indexOf("%")>=0?v=parseFloat(v.replace("%",""))/100*n:"string"==typeof v&&(v=parseFloat(v)),e.virtualSize=-v,p.forEach((e=>{o?e.style.marginLeft="":e.style.marginRight="",e.style.marginBottom="",e.style.marginTop=""})),s.centeredSlides&&s.cssMode&&(setCSSProperty(r,"--swiper-centered-offset-before",""),setCSSProperty(r,"--swiper-centered-offset-after",""));const b=s.grid&&s.grid.rows>1&&e.grid;let M;b&&e.grid.initSlides(h);const L="auto"===s.slidesPerView&&s.breakpoints&&Object.keys(s.breakpoints).filter((e=>void 0!==s.breakpoints[e].slidesPerView)).length>0;for(let r=0;r<h;r+=1){let l;if(M=0,p[r]&&(l=p[r]),b&&e.grid.updateSlide(r,l,h,t),!p[r]||"none"!==elementStyle(l,"display")){if("auto"===s.slidesPerView){L&&(p[r].style[t("width")]="");const n=getComputedStyle(l),o=l.style.transform,a=l.style.webkitTransform;if(o&&(l.style.transform="none"),a&&(l.style.webkitTransform="none"),s.roundLengths)M=e.isHorizontal()?elementOuterSize(l,"width",!0):elementOuterSize(l,"height",!0);else{const e=i(n,"width"),t=i(n,"padding-left"),s=i(n,"padding-right"),r=i(n,"margin-left"),o=i(n,"margin-right"),a=n.getPropertyValue("box-sizing");if(a&&"border-box"===a)M=e+r+o;else{const{clientWidth:i,offsetWidth:n}=l;M=e+t+s+r+o+(n-i)}}o&&(l.style.transform=o),a&&(l.style.webkitTransform=a),s.roundLengths&&(M=Math.floor(M))}else M=(n-(s.slidesPerView-1)*v)/s.slidesPerView,s.roundLengths&&(M=Math.floor(M)),p[r]&&(p[r].style[t("width")]=`${M}px`);p[r]&&(p[r].swiperSlideSize=M),u.push(M),s.centeredSlides?(z=z+M/2+G/2+v,0===G&&0!==r&&(z=z-n/2-v),0===r&&(z=z-n/2-v),Math.abs(z)<.001&&(z=0),s.roundLengths&&(z=Math.floor(z)),P%s.slidesPerGroup==0&&g.push(z),c.push(z)):(s.roundLengths&&(z=Math.floor(z)),(P-Math.min(e.params.slidesPerGroupSkip,P))%e.params.slidesPerGroup==0&&g.push(z),c.push(z),z=z+M+v),e.virtualSize+=M+v,G=M,P+=1}}if(e.virtualSize=Math.max(e.virtualSize,n)+S,o&&a&&("slide"===s.effect||"coverflow"===s.effect)&&(r.style.width=`${e.virtualSize+v}px`),s.setWrapperSize&&(r.style[t("width")]=`${e.virtualSize+v}px`),b&&e.grid.updateWrapperSize(M,g,t),!s.centeredSlides){const t=[];for(let i=0;i<g.length;i+=1){let r=g[i];s.roundLengths&&(r=Math.floor(r)),g[i]<=e.virtualSize-n&&t.push(r)}g=t,Math.floor(e.virtualSize-n)-Math.floor(g[g.length-1])>1&&g.push(e.virtualSize-n)}if(d&&s.loop){const t=u[0]+v;if(s.slidesPerGroup>1){const i=Math.ceil((e.virtual.slidesBefore+e.virtual.slidesAfter)/s.slidesPerGroup),r=t*s.slidesPerGroup;for(let e=0;e<i;e+=1)g.push(g[g.length-1]+r)}for(let i=0;i<e.virtual.slidesBefore+e.virtual.slidesAfter;i+=1)1===s.slidesPerGroup&&g.push(g[g.length-1]+t),c.push(c[c.length-1]+t),e.virtualSize+=t}if(0===g.length&&(g=[0]),0!==v){const i=e.isHorizontal()&&o?"marginLeft":t("marginRight");p.filter(((e,t)=>!(s.cssMode&&!s.loop)||t!==p.length-1)).forEach((e=>{e.style[i]=`${v}px`}))}if(s.centeredSlides&&s.centeredSlidesBounds){let e=0;u.forEach((t=>{e+=t+(v||0)})),e-=v;const t=e-n;g=g.map((e=>e<0?-m:e>t?t+S:e))}if(s.centerInsufficientSlides){let e=0;if(u.forEach((t=>{e+=t+(v||0)})),e-=v,e<n){const t=(n-e)/2;g.forEach(((e,i)=>{g[i]=e-t})),c.forEach(((e,i)=>{c[i]=e+t}))}}if(Object.assign(e,{slides:p,snapGrid:g,slidesGrid:c,slidesSizesGrid:u}),s.centeredSlides&&s.cssMode&&!s.centeredSlidesBounds){setCSSProperty(r,"--swiper-centered-offset-before",-g[0]+"px"),setCSSProperty(r,"--swiper-centered-offset-after",e.size/2-u[u.length-1]/2+"px");const t=-e.snapGrid[0],i=-e.slidesGrid[0];e.snapGrid=e.snapGrid.map((e=>e+t)),e.slidesGrid=e.slidesGrid.map((e=>e+i))}if(h!==f&&e.emit("slidesLengthChange"),g.length!==y&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),c.length!==w&&e.emit("slidesGridLengthChange"),s.watchSlidesProgress&&e.updateSlidesOffset(),!(d||s.cssMode||"slide"!==s.effect&&"fade"!==s.effect)){const t=`${s.containerModifierClass}backface-hidden`,i=e.el.classList.contains(t);h<=s.maxBackfaceHiddenSlides?i||e.el.classList.add(t):i&&e.el.classList.remove(t)}}