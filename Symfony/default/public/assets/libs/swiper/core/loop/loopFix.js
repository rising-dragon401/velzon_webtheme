export default function loopFix({slideRealIndex:e,slideTo:l=!0,direction:s,setTranslate:o,activeSlideIndex:i,byController:t,byMousewheel:r}={}){const d=this;if(!d.params.loop)return;d.emit("beforeLoopFix");const{slides:n,allowSlidePrev:a,allowSlideNext:c,slidesEl:p,params:h}=d;if(d.allowSlidePrev=!0,d.allowSlideNext=!0,d.virtual&&h.virtual.enabled)return l&&(h.centeredSlides||0!==d.snapIndex?h.centeredSlides&&d.snapIndex<h.slidesPerView?d.slideTo(d.virtual.slides.length+d.snapIndex,0,!1,!0):d.snapIndex===d.snapGrid.length-1&&d.slideTo(d.virtual.slidesBefore,0,!1,!0):d.slideTo(d.virtual.slides.length,0,!1,!0)),d.allowSlidePrev=a,d.allowSlideNext=c,void d.emit("loopFix");const f="auto"===h.slidesPerView?d.slidesPerViewDynamic():Math.ceil(parseFloat(h.slidesPerView,10));let u=h.loopedSlides||f;u%h.slidesPerGroup!=0&&(u+=h.slidesPerGroup-u%h.slidesPerGroup),d.loopedSlides=u;const x=[],v=[];let w=d.activeIndex;void 0===i?i=d.getSlideIndex(d.slides.filter((e=>e.classList.contains(h.slideActiveClass)))[0]):w=i;const S="next"===s||!s,P="prev"===s||!s;let g=0,M=0;if(i<u){g=Math.max(u-i,h.slidesPerGroup);for(let e=0;e<u-i;e+=1){const l=e-Math.floor(e/n.length)*n.length;x.push(n.length-l-1)}}else if(i>d.slides.length-2*u){M=Math.max(i-(d.slides.length-2*u),h.slidesPerGroup);for(let e=0;e<M;e+=1){const l=e-Math.floor(e/n.length)*n.length;v.push(l)}}if(P&&x.forEach((e=>{d.slides[e].swiperLoopMoveDOM=!0,p.prepend(d.slides[e]),d.slides[e].swiperLoopMoveDOM=!1})),S&&v.forEach((e=>{d.slides[e].swiperLoopMoveDOM=!0,p.append(d.slides[e]),d.slides[e].swiperLoopMoveDOM=!1})),d.recalcSlides(),"auto"===h.slidesPerView&&d.updateSlides(),h.watchSlidesProgress&&d.updateSlidesOffset(),l)if(x.length>0&&P)if(void 0===e){const e=d.slidesGrid[w],l=d.slidesGrid[w+g]-e;r?d.setTranslate(d.translate-l):(d.slideTo(w+g,0,!1,!0),o&&(d.touches[d.isHorizontal()?"startX":"startY"]+=l))}else o&&d.slideToLoop(e,0,!1,!0);else if(v.length>0&&S)if(void 0===e){const e=d.slidesGrid[w],l=d.slidesGrid[w-M]-e;r?d.setTranslate(d.translate-l):(d.slideTo(w-M,0,!1,!0),o&&(d.touches[d.isHorizontal()?"startX":"startY"]+=l))}else d.slideToLoop(e,0,!1,!0);if(d.allowSlidePrev=a,d.allowSlideNext=c,d.controller&&d.controller.control&&!t){const l={slideRealIndex:e,slideTo:!1,direction:s,setTranslate:o,activeSlideIndex:i,byController:!0};Array.isArray(d.controller.control)?d.controller.control.forEach((e=>{!e.destroyed&&e.params.loop&&e.loopFix(l)})):d.controller.control instanceof d.constructor&&d.controller.control.params.loop&&d.controller.control.loopFix(l)}d.emit("loopFix")}