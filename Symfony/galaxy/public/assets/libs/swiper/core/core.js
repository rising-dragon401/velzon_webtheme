import{getDocument}from"ssr-window";import{extend,deleteProps,createElement,elementChildren,elementStyle,elementIndex}from"../shared/utils.js";import{getSupport}from"../shared/get-support.js";import{getDevice}from"../shared/get-device.js";import{getBrowser}from"../shared/get-browser.js";import Resize from"./modules/resize/resize.js";import Observer from"./modules/observer/observer.js";import eventsEmitter from"./events-emitter.js";import update from"./update/index.js";import translate from"./translate/index.js";import transition from"./transition/index.js";import slide from"./slide/index.js";import loop from"./loop/index.js";import grabCursor from"./grab-cursor/index.js";import events from"./events/index.js";import breakpoints from"./breakpoints/index.js";import classes from"./classes/index.js";import checkOverflow from"./check-overflow/index.js";import defaults from"./defaults.js";import moduleExtendParams from"./moduleExtendParams.js";import{processLazyPreloader,preload}from"../shared/process-lazy-preloader.js";const prototypes={eventsEmitter,update,translate,transition,slide,loop,grabCursor,events,breakpoints,checkOverflow,classes},extendedDefaults={};class Swiper{constructor(...e){let s,t;1===e.length&&e[0].constructor&&"Object"===Object.prototype.toString.call(e[0]).slice(8,-1)?t=e[0]:[s,t]=e,t||(t={}),t=extend({},t),s&&!t.el&&(t.el=s);const r=getDocument();if(t.el&&"string"==typeof t.el&&r.querySelectorAll(t.el).length>1){const e=[];return r.querySelectorAll(t.el).forEach((s=>{const r=extend({},t,{el:s});e.push(new Swiper(r))})),e}const a=this;a.__swiper__=!0,a.support=getSupport(),a.device=getDevice({userAgent:t.userAgent}),a.browser=getBrowser(),a.eventsListeners={},a.eventsAnyListeners=[],a.modules=[...a.__modules__],t.modules&&Array.isArray(t.modules)&&a.modules.push(...t.modules);const i={};a.modules.forEach((e=>{e({params:t,swiper:a,extendParams:moduleExtendParams(t,i),on:a.on.bind(a),once:a.once.bind(a),off:a.off.bind(a),emit:a.emit.bind(a)})}));const l=extend({},defaults,i);return a.params=extend({},l,extendedDefaults,t),a.originalParams=extend({},a.params),a.passedParams=extend({},t),a.params&&a.params.on&&Object.keys(a.params.on).forEach((e=>{a.on(e,a.params.on[e])})),a.params&&a.params.onAny&&a.onAny(a.params.onAny),Object.assign(a,{enabled:a.params.enabled,el:s,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===a.params.direction,isVertical:()=>"vertical"===a.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:a.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,evCache:[]},allowClick:!0,allowTouchMove:a.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),a.emit("_swiper"),a.params.init&&a.init(),a}getSlideIndex(e){const{slidesEl:s,params:t}=this,r=elementChildren(s,`.${t.slideClass}, swiper-slide`),a=elementIndex(r[0]);return elementIndex(e)-a}getSlideIndexByData(e){return this.getSlideIndex(this.slides.filter((s=>1*s.getAttribute("data-swiper-slide-index")===e))[0])}recalcSlides(){const{slidesEl:e,params:s}=this;this.slides=elementChildren(e,`.${s.slideClass}, swiper-slide`)}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,s){const t=this;e=Math.min(Math.max(e,0),1);const r=t.minTranslate(),a=(t.maxTranslate()-r)*e+r;t.translateTo(a,void 0===s?0:s),t.updateActiveIndex(),t.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const s=e.el.className.split(" ").filter((s=>0===s.indexOf("swiper")||0===s.indexOf(e.params.containerModifierClass)));e.emit("_containerClasses",s.join(" "))}getSlideClasses(e){const s=this;return s.destroyed?"":e.className.split(" ").filter((e=>0===e.indexOf("swiper-slide")||0===e.indexOf(s.params.slideClass))).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const s=[];e.slides.forEach((t=>{const r=e.getSlideClasses(t);s.push({slideEl:t,classNames:r}),e.emit("_slideClass",t,r)})),e.emit("_slideClasses",s)}slidesPerViewDynamic(e="current",s=!1){const{params:t,slides:r,slidesGrid:a,slidesSizesGrid:i,size:l,activeIndex:o}=this;let n=1;if(t.centeredSlides){let e,s=r[o].swiperSlideSize;for(let t=o+1;t<r.length;t+=1)r[t]&&!e&&(s+=r[t].swiperSlideSize,n+=1,s>l&&(e=!0));for(let t=o-1;t>=0;t-=1)r[t]&&!e&&(s+=r[t].swiperSlideSize,n+=1,s>l&&(e=!0))}else if("current"===e)for(let e=o+1;e<r.length;e+=1){(s?a[e]+i[e]-a[o]<l:a[e]-a[o]<l)&&(n+=1)}else for(let e=o-1;e>=0;e-=1){a[o]-a[e]<l&&(n+=1)}return n}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:s,params:t}=e;function r(){const s=e.rtlTranslate?-1*e.translate:e.translate,t=Math.min(Math.max(s,e.maxTranslate()),e.minTranslate());e.setTranslate(t),e.updateActiveIndex(),e.updateSlidesClasses()}let a;if(t.breakpoints&&e.setBreakpoint(),[...e.el.querySelectorAll('[loading="lazy"]')].forEach((s=>{s.complete&&processLazyPreloader(e,s)})),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.params.freeMode&&e.params.freeMode.enabled)r(),e.params.autoHeight&&e.updateAutoHeight();else{if(("auto"===e.params.slidesPerView||e.params.slidesPerView>1)&&e.isEnd&&!e.params.centeredSlides){const s=e.virtual&&e.params.virtual.enabled?e.virtual.slides:e.slides;a=e.slideTo(s.length-1,0,!1,!0)}else a=e.slideTo(e.activeIndex,0,!1,!0);a||r()}t.watchOverflow&&s!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,s=!0){const t=this,r=t.params.direction;return e||(e="horizontal"===r?"vertical":"horizontal"),e===r||"horizontal"!==e&&"vertical"!==e||(t.el.classList.remove(`${t.params.containerModifierClass}${r}`),t.el.classList.add(`${t.params.containerModifierClass}${e}`),t.emitContainerClasses(),t.params.direction=e,t.slides.forEach((s=>{"vertical"===e?s.style.width="":s.style.height=""})),t.emit("changeDirection"),s&&t.update()),t}changeLanguageDirection(e){const s=this;s.rtl&&"rtl"===e||!s.rtl&&"ltr"===e||(s.rtl="rtl"===e,s.rtlTranslate="horizontal"===s.params.direction&&s.rtl,s.rtl?(s.el.classList.add(`${s.params.containerModifierClass}rtl`),s.el.dir="rtl"):(s.el.classList.remove(`${s.params.containerModifierClass}rtl`),s.el.dir="ltr"),s.update())}mount(e){const s=this;if(s.mounted)return!0;let t=e||s.params.el;if("string"==typeof t&&(t=document.querySelector(t)),!t)return!1;t.swiper=s,t.shadowEl&&(s.isElement=!0);const r=()=>`.${(s.params.wrapperClass||"").trim().split(" ").join(".")}`;let a=(()=>{if(t&&t.shadowRoot&&t.shadowRoot.querySelector){return t.shadowRoot.querySelector(r())}return elementChildren(t,r())[0]})();return!a&&s.params.createElements&&(a=createElement("div",s.params.wrapperClass),t.append(a),elementChildren(t,`.${s.params.slideClass}`).forEach((e=>{a.append(e)}))),Object.assign(s,{el:t,wrapperEl:a,slidesEl:s.isElement?t:a,mounted:!0,rtl:"rtl"===t.dir.toLowerCase()||"rtl"===elementStyle(t,"direction"),rtlTranslate:"horizontal"===s.params.direction&&("rtl"===t.dir.toLowerCase()||"rtl"===elementStyle(t,"direction")),wrongRTL:"-webkit-box"===elementStyle(a,"display")}),!0}init(e){const s=this;if(s.initialized)return s;return!1===s.mount(e)||(s.emit("beforeInit"),s.params.breakpoints&&s.setBreakpoint(),s.addClasses(),s.updateSize(),s.updateSlides(),s.params.watchOverflow&&s.checkOverflow(),s.params.grabCursor&&s.enabled&&s.setGrabCursor(),s.params.loop&&s.virtual&&s.params.virtual.enabled?s.slideTo(s.params.initialSlide+s.virtual.slidesBefore,0,s.params.runCallbacksOnInit,!1,!0):s.slideTo(s.params.initialSlide,0,s.params.runCallbacksOnInit,!1,!0),s.params.loop&&s.loopCreate(),s.attachEvents(),[...s.el.querySelectorAll('[loading="lazy"]')].forEach((e=>{e.complete?processLazyPreloader(s,e):e.addEventListener("load",(e=>{processLazyPreloader(s,e.target)}))})),preload(s),s.initialized=!0,preload(s),s.emit("init"),s.emit("afterInit")),s}destroy(e=!0,s=!0){const t=this,{params:r,el:a,wrapperEl:i,slides:l}=t;return void 0===t.params||t.destroyed||(t.emit("beforeDestroy"),t.initialized=!1,t.detachEvents(),r.loop&&t.loopDestroy(),s&&(t.removeClasses(),a.removeAttribute("style"),i.removeAttribute("style"),l&&l.length&&l.forEach((e=>{e.classList.remove(r.slideVisibleClass,r.slideActiveClass,r.slideNextClass,r.slidePrevClass),e.removeAttribute("style"),e.removeAttribute("data-swiper-slide-index")}))),t.emit("destroy"),Object.keys(t.eventsListeners).forEach((e=>{t.off(e)})),!1!==e&&(t.el.swiper=null,deleteProps(t)),t.destroyed=!0),null}static extendDefaults(e){extend(extendedDefaults,e)}static get extendedDefaults(){return extendedDefaults}static get defaults(){return defaults}static installModule(e){Swiper.prototype.__modules__||(Swiper.prototype.__modules__=[]);const s=Swiper.prototype.__modules__;"function"==typeof e&&s.indexOf(e)<0&&s.push(e)}static use(e){return Array.isArray(e)?(e.forEach((e=>Swiper.installModule(e))),Swiper):(Swiper.installModule(e),Swiper)}}Object.keys(prototypes).forEach((e=>{Object.keys(prototypes[e]).forEach((s=>{Swiper.prototype[s]=prototypes[e][s]}))})),Swiper.use([Resize,Observer]);export default Swiper;