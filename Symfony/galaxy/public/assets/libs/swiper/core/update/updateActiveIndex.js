import{preload}from"../../shared/process-lazy-preloader.js";export function getActiveIndexByTranslate(e){const{slidesGrid:a,params:t}=e,n=e.rtlTranslate?e.translate:-e.translate;let i;for(let e=0;e<a.length;e+=1)void 0!==a[e+1]?n>=a[e]&&n<a[e+1]-(a[e+1]-a[e])/2?i=e:n>=a[e]&&n<a[e+1]&&(i=e+1):n>=a[e]&&(i=e);return t.normalizeSlideIndex&&(i<0||void 0===i)&&(i=0),i}export default function updateActiveIndex(e){const a=this,t=a.rtlTranslate?a.translate:-a.translate,{snapGrid:n,params:i,activeIndex:l,realIndex:r,snapIndex:s}=a;let d,o=e;const p=e=>{let t=e-a.virtual.slidesBefore;return t<0&&(t=a.virtual.slides.length+t),t>=a.virtual.slides.length&&(t-=a.virtual.slides.length),t};if(void 0===o&&(o=getActiveIndexByTranslate(a)),n.indexOf(t)>=0)d=n.indexOf(t);else{const e=Math.min(i.slidesPerGroupSkip,o);d=e+Math.floor((o-e)/i.slidesPerGroup)}if(d>=n.length&&(d=n.length-1),o===l)return d!==s&&(a.snapIndex=d,a.emit("snapIndexChange")),void(a.params.loop&&a.virtual&&a.params.virtual.enabled&&(a.realIndex=p(o)));let x;x=a.virtual&&i.virtual.enabled&&i.loop?p(o):a.slides[o]?parseInt(a.slides[o].getAttribute("data-swiper-slide-index")||o,10):o,Object.assign(a,{previousSnapIndex:s,snapIndex:d,previousRealIndex:r,realIndex:x,previousIndex:l,activeIndex:o}),a.initialized&&preload(a),a.emit("activeIndexChange"),a.emit("snapIndexChange"),r!==x&&a.emit("realIndexChange"),(a.initialized||a.params.runCallbacksOnInit)&&a.emit("slideChange")}