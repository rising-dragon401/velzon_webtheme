import classesToSelector from"../../shared/classes-to-selector.js";import{createElement,elementIndex}from"../../shared/utils.js";export default function A11y({swiper:e,extendParams:a,on:t}){a({a11y:{enabled:!0,notificationClass:"swiper-notification",prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",slideLabelMessage:"{{index}} / {{slidesLength}}",containerMessage:null,containerRoleDescriptionMessage:null,itemRoleDescriptionMessage:null,slideRole:"group",id:null}}),e.a11y={clicked:!1};let i=null;function n(e){const a=i;0!==a.length&&(a.innerHTML="",a.innerHTML=e)}const s=e=>(Array.isArray(e)||(e=[e].filter((e=>!!e))),e);function r(e){(e=s(e)).forEach((e=>{e.setAttribute("tabIndex","0")}))}function o(e){(e=s(e)).forEach((e=>{e.setAttribute("tabIndex","-1")}))}function l(e,a){(e=s(e)).forEach((e=>{e.setAttribute("role",a)}))}function c(e,a){(e=s(e)).forEach((e=>{e.setAttribute("aria-roledescription",a)}))}function d(e,a){(e=s(e)).forEach((e=>{e.setAttribute("aria-label",a)}))}function p(e){(e=s(e)).forEach((e=>{e.setAttribute("aria-disabled",!0)}))}function g(e){(e=s(e)).forEach((e=>{e.setAttribute("aria-disabled",!1)}))}function u(a){if(13!==a.keyCode&&32!==a.keyCode)return;const t=e.params.a11y,i=a.target;e.pagination&&e.pagination.el&&(i===e.pagination.el||e.pagination.el.contains(a.target))&&!a.target.matches(classesToSelector(e.params.pagination.bulletClass))||(e.navigation&&e.navigation.nextEl&&i===e.navigation.nextEl&&(e.isEnd&&!e.params.loop||e.slideNext(),e.isEnd?n(t.lastSlideMessage):n(t.nextSlideMessage)),e.navigation&&e.navigation.prevEl&&i===e.navigation.prevEl&&(e.isBeginning&&!e.params.loop||e.slidePrev(),e.isBeginning?n(t.firstSlideMessage):n(t.prevSlideMessage)),e.pagination&&i.matches(classesToSelector(e.params.pagination.bulletClass))&&i.click())}function f(){return e.pagination&&e.pagination.bullets&&e.pagination.bullets.length}function m(){return f()&&e.params.pagination.clickable}const v=(e,a,t)=>{r(e),"BUTTON"!==e.tagName&&(l(e,"button"),e.addEventListener("keydown",u)),d(e,t),function(e,a){(e=s(e)).forEach((e=>{e.setAttribute("aria-controls",a)}))}(e,a)},E=()=>{e.a11y.clicked=!0},b=()=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{e.destroyed||(e.a11y.clicked=!1)}))}))},h=a=>{if(e.a11y.clicked)return;const t=a.target.closest(`.${e.params.slideClass}, swiper-slide`);if(!t||!e.slides.includes(t))return;const i=e.slides.indexOf(t)===e.activeIndex,n=e.params.watchSlidesProgress&&e.visibleSlides&&e.visibleSlides.includes(t);i||n||a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents||(e.isHorizontal()?e.el.scrollLeft=0:e.el.scrollTop=0,e.slideTo(e.slides.indexOf(t),0))},y=()=>{const a=e.params.a11y;a.itemRoleDescriptionMessage&&c(e.slides,a.itemRoleDescriptionMessage),a.slideRole&&l(e.slides,a.slideRole);const t=e.slides.length;a.slideLabelMessage&&e.slides.forEach(((i,n)=>{const s=e.params.loop?parseInt(i.getAttribute("data-swiper-slide-index"),10):n;d(i,a.slideLabelMessage.replace(/\{\{index\}\}/,s+1).replace(/\{\{slidesLength\}\}/,t))}))},M=()=>{const a=e.params.a11y;e.isElement?e.el.shadowEl.append(i):e.el.append(i);const t=e.el;a.containerRoleDescriptionMessage&&c(t,a.containerRoleDescriptionMessage),a.containerMessage&&d(t,a.containerMessage);const n=e.wrapperEl,r=a.id||n.getAttribute("id")||`swiper-wrapper-${function(e=16){return"x".repeat(e).replace(/x/g,(()=>Math.round(16*Math.random()).toString(16)))}(16)}`,o=e.params.autoplay&&e.params.autoplay.enabled?"off":"polite";var l;l=r,s(n).forEach((e=>{e.setAttribute("id",l)})),function(e,a){(e=s(e)).forEach((e=>{e.setAttribute("aria-live",a)}))}(n,o),y();let{nextEl:p,prevEl:g}=e.navigation?e.navigation:{};if(p=s(p),g=s(g),p&&p.forEach((e=>v(e,r,a.nextSlideMessage))),g&&g.forEach((e=>v(e,r,a.prevSlideMessage))),m()){(Array.isArray(e.pagination.el)?e.pagination.el:[e.pagination.el]).forEach((e=>{e.addEventListener("keydown",u)}))}e.el.addEventListener("focus",h,!0),e.el.addEventListener("pointerdown",E,!0),e.el.addEventListener("pointerup",b,!0)};t("beforeInit",(()=>{i=createElement("span",e.params.a11y.notificationClass),i.setAttribute("aria-live","assertive"),i.setAttribute("aria-atomic","true")})),t("afterInit",(()=>{e.params.a11y.enabled&&M()})),t("slidesLengthChange snapGridLengthChange slidesGridLengthChange",(()=>{e.params.a11y.enabled&&y()})),t("fromEdge toEdge afterInit lock unlock",(()=>{e.params.a11y.enabled&&function(){if(e.params.loop||e.params.rewind||!e.navigation)return;const{nextEl:a,prevEl:t}=e.navigation;t&&(e.isBeginning?(p(t),o(t)):(g(t),r(t))),a&&(e.isEnd?(p(a),o(a)):(g(a),r(a)))}()})),t("paginationUpdate",(()=>{e.params.a11y.enabled&&function(){const a=e.params.a11y;f()&&e.pagination.bullets.forEach((t=>{e.params.pagination.clickable&&(r(t),e.params.pagination.renderBullet||(l(t,"button"),d(t,a.paginationBulletMessage.replace(/\{\{index\}\}/,elementIndex(t)+1)))),t.matches(classesToSelector(e.params.pagination.bulletActiveClass))?t.setAttribute("aria-current","true"):t.removeAttribute("aria-current")}))}()})),t("destroy",(()=>{e.params.a11y.enabled&&function(){i&&i.remove();let{nextEl:a,prevEl:t}=e.navigation?e.navigation:{};a=s(a),t=s(t),a&&a.forEach((e=>e.removeEventListener("keydown",u))),t&&t.forEach((e=>e.removeEventListener("keydown",u))),m()&&(Array.isArray(e.pagination.el)?e.pagination.el:[e.pagination.el]).forEach((e=>{e.removeEventListener("keydown",u)}));e.el.removeEventListener("focus",h,!0),e.el.removeEventListener("pointerdown",E,!0),e.el.removeEventListener("pointerup",b,!0)}()}))}