import createShadow from"../../shared/create-shadow.js";import effectInit from"../../shared/effect-init.js";import effectTarget from"../../shared/effect-target.js";import{getSlideTransformEl}from"../../shared/utils.js";export default function EffectCoverflow({swiper:e,extendParams:t,on:s}){t({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}});effectInit({effect:"coverflow",swiper:e,on:s,setTranslate:()=>{const{width:t,height:s,slides:r,slidesSizesGrid:a}=e,o=e.params.coverflowEffect,i=e.isHorizontal(),l=e.translate,d=i?t/2-l:s/2-l,f=i?o.rotate:-o.rotate,h=o.depth;for(let e=0,t=r.length;e<t;e+=1){const t=r[e],s=a[e],l=(d-t.swiperSlideOffset-s/2)/s,c="function"==typeof o.modifier?o.modifier(l):l*o.modifier;let n=i?f*c:0,p=i?0:f*c,w=-h*Math.abs(c),m=o.stretch;"string"==typeof m&&-1!==m.indexOf("%")&&(m=parseFloat(o.stretch)/100*s);let y=i?0:m*c,S=i?m*c:0,g=1-(1-o.scale)*Math.abs(c);Math.abs(S)<.001&&(S=0),Math.abs(y)<.001&&(y=0),Math.abs(w)<.001&&(w=0),Math.abs(n)<.001&&(n=0),Math.abs(p)<.001&&(p=0),Math.abs(g)<.001&&(g=0);const b=`translate3d(${S}px,${y}px,${w}px)  rotateX(${p}deg) rotateY(${n}deg) scale(${g})`;if(effectTarget(o,t).style.transform=b,t.style.zIndex=1-Math.abs(Math.round(c)),o.slideShadows){let e=i?t.querySelector(".swiper-slide-shadow-left"):t.querySelector(".swiper-slide-shadow-top"),s=i?t.querySelector(".swiper-slide-shadow-right"):t.querySelector(".swiper-slide-shadow-bottom");e||(e=createShadow(o,t,i?"left":"top")),s||(s=createShadow(o,t,i?"right":"bottom")),e&&(e.style.opacity=c>0?c:0),s&&(s.style.opacity=-c>0?-c:0)}}},setTransition:t=>{e.slides.map((e=>getSlideTransformEl(e))).forEach((e=>{e.style.transitionDuration=`${t}ms`,e.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((e=>{e.style.transitionDuration=`${t}ms`}))}))},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}