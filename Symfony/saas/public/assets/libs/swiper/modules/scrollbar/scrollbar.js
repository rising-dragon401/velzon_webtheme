import{getDocument}from"ssr-window";import{createElement,elementOffset,nextTick}from"../../shared/utils.js";import createElementIfNotDefined from"../../shared/create-element-if-not-defined.js";export default function Scrollbar({swiper:l,extendParams:r,on:s,emit:e}){const a=getDocument();let t,o,n,i,c=!1,p=null,d=null;function b(){if(!l.params.scrollbar.el||!l.scrollbar.el)return;const{scrollbar:r,rtlTranslate:s}=l,{dragEl:e,el:a}=r,t=l.params.scrollbar,i=l.params.loop?l.progressLoop:l.progress;let c=o,d=(n-o)*i;s?(d=-d,d>0?(c=o-d,d=0):-d+o>n&&(c=n+d)):d<0?(c=o+d,d=0):d+o>n&&(c=n-d),l.isHorizontal()?(e.style.transform=`translate3d(${d}px, 0, 0)`,e.style.width=`${c}px`):(e.style.transform=`translate3d(0px, ${d}px, 0)`,e.style.height=`${c}px`),t.hide&&(clearTimeout(p),a.style.opacity=1,p=setTimeout((()=>{a.style.opacity=0,a.style.transitionDuration="400ms"}),1e3))}function m(){if(!l.params.scrollbar.el||!l.scrollbar.el)return;const{scrollbar:r}=l,{dragEl:s,el:e}=r;s.style.width="",s.style.height="",n=l.isHorizontal()?e.offsetWidth:e.offsetHeight,i=l.size/(l.virtualSize+l.params.slidesOffsetBefore-(l.params.centeredSlides?l.snapGrid[0]:0)),o="auto"===l.params.scrollbar.dragSize?n*i:parseInt(l.params.scrollbar.dragSize,10),l.isHorizontal()?s.style.width=`${o}px`:s.style.height=`${o}px`,e.style.display=i>=1?"none":"",l.params.scrollbar.hide&&(e.style.opacity=0),l.params.watchOverflow&&l.enabled&&r.el.classList[l.isLocked?"add":"remove"](l.params.scrollbar.lockClass)}function u(r){return l.isHorizontal()?r.clientX:r.clientY}function f(r){const{scrollbar:s,rtlTranslate:e}=l,{el:a}=s;let i;i=(u(r)-elementOffset(a)[l.isHorizontal()?"left":"top"]-(null!==t?t:o/2))/(n-o),i=Math.max(Math.min(i,1),0),e&&(i=1-i);const c=l.minTranslate()+(l.maxTranslate()-l.minTranslate())*i;l.updateProgress(c),l.setTranslate(c),l.updateActiveIndex(),l.updateSlidesClasses()}function g(r){const s=l.params.scrollbar,{scrollbar:a,wrapperEl:o}=l,{el:n,dragEl:i}=a;c=!0,t=r.target===i?u(r)-r.target.getBoundingClientRect()[l.isHorizontal()?"left":"top"]:null,r.preventDefault(),r.stopPropagation(),o.style.transitionDuration="100ms",i.style.transitionDuration="100ms",f(r),clearTimeout(d),n.style.transitionDuration="0ms",s.hide&&(n.style.opacity=1),l.params.cssMode&&(l.wrapperEl.style["scroll-snap-type"]="none"),e("scrollbarDragStart",r)}function y(r){const{scrollbar:s,wrapperEl:a}=l,{el:t,dragEl:o}=s;c&&(r.preventDefault?r.preventDefault():r.returnValue=!1,f(r),a.style.transitionDuration="0ms",t.style.transitionDuration="0ms",o.style.transitionDuration="0ms",e("scrollbarDragMove",r))}function h(r){const s=l.params.scrollbar,{scrollbar:a,wrapperEl:t}=l,{el:o}=a;c&&(c=!1,l.params.cssMode&&(l.wrapperEl.style["scroll-snap-type"]="",t.style.transitionDuration=""),s.hide&&(clearTimeout(d),d=nextTick((()=>{o.style.opacity=0,o.style.transitionDuration="400ms"}),1e3)),e("scrollbarDragEnd",r),s.snapOnRelease&&l.slideToClosest())}function v(r){const{scrollbar:s,params:e}=l,t=s.el;if(!t)return;const o=t,n=!!e.passiveListeners&&{passive:!1,capture:!1},i=!!e.passiveListeners&&{passive:!0,capture:!1};if(!o)return;const c="on"===r?"addEventListener":"removeEventListener";o[c]("pointerdown",g,n),a[c]("pointermove",y,n),a[c]("pointerup",h,i)}function D(){const{scrollbar:r,el:s}=l;l.params.scrollbar=createElementIfNotDefined(l,l.originalParams.scrollbar,l.params.scrollbar,{el:"swiper-scrollbar"});const e=l.params.scrollbar;if(!e.el)return;let t,o;"string"==typeof e.el&&l.isElement&&(t=l.el.shadowRoot.querySelector(e.el)),t||"string"!=typeof e.el?t||(t=e.el):t=a.querySelectorAll(e.el),l.params.uniqueNavElements&&"string"==typeof e.el&&t.length>1&&1===s.querySelectorAll(e.el).length&&(t=s.querySelector(e.el)),t.length>0&&(t=t[0]),t.classList.add(l.isHorizontal()?e.horizontalClass:e.verticalClass),t&&(o=t.querySelector(`.${l.params.scrollbar.dragClass}`),o||(o=createElement("div",l.params.scrollbar.dragClass),t.append(o))),Object.assign(r,{el:t,dragEl:o}),e.draggable&&l.params.scrollbar.el&&l.scrollbar.el&&v("on"),t&&t.classList[l.enabled?"remove":"add"](l.params.scrollbar.lockClass)}function w(){const r=l.params.scrollbar,s=l.scrollbar.el;s&&s.classList.remove(l.isHorizontal()?r.horizontalClass:r.verticalClass),l.params.scrollbar.el&&l.scrollbar.el&&v("off")}r({scrollbar:{el:null,dragSize:"auto",hide:!1,draggable:!1,snapOnRelease:!0,lockClass:"swiper-scrollbar-lock",dragClass:"swiper-scrollbar-drag",scrollbarDisabledClass:"swiper-scrollbar-disabled",horizontalClass:"swiper-scrollbar-horizontal",verticalClass:"swiper-scrollbar-vertical"}}),l.scrollbar={el:null,dragEl:null},s("init",(()=>{!1===l.params.scrollbar.enabled?C():(D(),m(),b())})),s("update resize observerUpdate lock unlock",(()=>{m()})),s("setTranslate",(()=>{b()})),s("setTransition",((r,s)=>{!function(r){l.params.scrollbar.el&&l.scrollbar.el&&(l.scrollbar.dragEl.style.transitionDuration=`${r}ms`)}(s)})),s("enable disable",(()=>{const{el:r}=l.scrollbar;r&&r.classList[l.enabled?"remove":"add"](l.params.scrollbar.lockClass)})),s("destroy",(()=>{w()}));const C=()=>{l.el.classList.add(l.params.scrollbar.scrollbarDisabledClass),l.scrollbar.el&&l.scrollbar.el.classList.add(l.params.scrollbar.scrollbarDisabledClass),w()};Object.assign(l.scrollbar,{enable:()=>{l.el.classList.remove(l.params.scrollbar.scrollbarDisabledClass),l.scrollbar.el&&l.scrollbar.el.classList.remove(l.params.scrollbar.scrollbarDisabledClass),D(),m(),b()},disable:C,updateSize:m,setTranslate:b,init:D,destroy:w})}