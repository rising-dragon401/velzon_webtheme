import createShadow from"../../shared/create-shadow.js";import effectInit from"../../shared/effect-init.js";import effectTarget from"../../shared/effect-target.js";import effectVirtualTransitionEnd from"../../shared/effect-virtual-transition-end.js";import{getSlideTransformEl}from"../../shared/utils.js";export default function EffectFlip({swiper:e,extendParams:t,on:s}){t({flipEffect:{slideShadows:!0,limitRotation:!0}});const r=(t,s,r)=>{let a=e.isHorizontal()?t.querySelector(".swiper-slide-shadow-left"):t.querySelector(".swiper-slide-shadow-top"),i=e.isHorizontal()?t.querySelector(".swiper-slide-shadow-right"):t.querySelector(".swiper-slide-shadow-bottom");a||(a=createShadow(r,t,e.isHorizontal()?"left":"top")),i||(i=createShadow(r,t,e.isHorizontal()?"right":"bottom")),a&&(a.style.opacity=Math.max(-s,0)),i&&(i.style.opacity=Math.max(s,0))};effectInit({effect:"flip",swiper:e,on:s,setTranslate:()=>{const{slides:t,rtlTranslate:s}=e,a=e.params.flipEffect;for(let i=0;i<t.length;i+=1){const o=t[i];let l=o.progress;e.params.flipEffect.limitRotation&&(l=Math.max(Math.min(o.progress,1),-1));const f=o.swiperSlideOffset;let n=-180*l,d=0,p=e.params.cssMode?-f-e.translate:-f,c=0;e.isHorizontal()?s&&(n=-n):(c=p,p=0,d=-n,n=0),o.style.zIndex=-Math.abs(Math.round(l))+t.length,a.slideShadows&&r(o,l,a);const m=`translate3d(${p}px, ${c}px, 0px) rotateX(${d}deg) rotateY(${n}deg)`;effectTarget(a,o).style.transform=m}},setTransition:t=>{const s=e.slides.map((e=>getSlideTransformEl(e)));s.forEach((e=>{e.style.transitionDuration=`${t}ms`,e.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((e=>{e.style.transitionDuration=`${t}ms`}))})),effectVirtualTransitionEnd({swiper:e,duration:t,transformElements:s})},recreateShadows:()=>{const t=e.params.flipEffect;e.slides.forEach((s=>{let a=s.progress;e.params.flipEffect.limitRotation&&(a=Math.max(Math.min(s.progress,1),-1)),r(s,a,t)}))},getEffectParams:()=>e.params.flipEffect,perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!e.params.cssMode})})}