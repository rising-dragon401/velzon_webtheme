import{getDocument}from"ssr-window";export default function Autoplay({swiper:e,extendParams:a,on:t,emit:n,params:r}){let i,o;e.autoplay={running:!1,paused:!1,timeLeft:0},a({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!0,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let s,p,l,u,d,y,m,c=r&&r.autoplay?r.autoplay.delay:3e3,g=r&&r.autoplay?r.autoplay.delay:3e3,v=(new Date).getTime;function T(a){e&&!e.destroyed&&e.wrapperEl&&a.target===e.wrapperEl&&(e.wrapperEl.removeEventListener("transitionend",T),D())}const w=()=>{if(e.destroyed||!e.autoplay.running)return;e.autoplay.paused?p=!0:p&&(g=s,p=!1);const a=e.autoplay.paused?s:v+g-(new Date).getTime();e.autoplay.timeLeft=a,n("autoplayTimeLeft",a,a/c),o=requestAnimationFrame((()=>{w()}))},E=a=>{if(e.destroyed||!e.autoplay.running)return;cancelAnimationFrame(o),w();let t=void 0===a?e.params.autoplay.delay:a;c=e.params.autoplay.delay,g=e.params.autoplay.delay;const r=(()=>{let a;if(a=e.virtual&&e.params.virtual.enabled?e.slides.filter((e=>e.classList.contains("swiper-slide-active")))[0]:e.slides[e.activeIndex],!a)return;return parseInt(a.getAttribute("data-swiper-autoplay"),10)})();!Number.isNaN(r)&&r>0&&void 0===a&&(t=r,c=r,g=r),s=t;const p=e.params.speed,l=()=>{e&&!e.destroyed&&(e.params.autoplay.reverseDirection?!e.isBeginning||e.params.loop||e.params.rewind?(e.slidePrev(p,!0,!0),n("autoplay")):e.params.autoplay.stopOnLastSlide||(e.slideTo(e.slides.length-1,p,!0,!0),n("autoplay")):!e.isEnd||e.params.loop||e.params.rewind?(e.slideNext(p,!0,!0),n("autoplay")):e.params.autoplay.stopOnLastSlide||(e.slideTo(0,p,!0,!0),n("autoplay")),e.params.cssMode&&(v=(new Date).getTime(),requestAnimationFrame((()=>{E()}))))};return t>0?(clearTimeout(i),i=setTimeout((()=>{l()}),t)):requestAnimationFrame((()=>{l()})),t},f=()=>{e.autoplay.running=!0,E(),n("autoplayStart")},b=()=>{e.autoplay.running=!1,clearTimeout(i),cancelAnimationFrame(o),n("autoplayStop")},L=(a,t)=>{if(e.destroyed||!e.autoplay.running)return;clearTimeout(i),a||(m=!0);const r=()=>{n("autoplayPause"),e.params.autoplay.waitForTransition?e.wrapperEl.addEventListener("transitionend",T):D()};if(e.autoplay.paused=!0,t)return y&&(s=e.params.autoplay.delay),y=!1,void r();const o=s||e.params.autoplay.delay;s=o-((new Date).getTime()-v),e.isEnd&&s<0&&!e.params.loop||(s<0&&(s=0),r())},D=()=>{e.isEnd&&s<0&&!e.params.loop||e.destroyed||!e.autoplay.running||(v=(new Date).getTime(),m?(m=!1,E(s)):E(),e.autoplay.paused=!1,n("autoplayResume"))},O=()=>{if(e.destroyed||!e.autoplay.running)return;const a=getDocument();"hidden"===a.visibilityState&&(m=!0,L(!0)),"visible"===a.visibilityState&&D()},F=e=>{"mouse"===e.pointerType&&(m=!0,L(!0))},S=a=>{"mouse"===a.pointerType&&e.autoplay.paused&&D()};t("init",(()=>{e.params.autoplay.enabled&&(e.params.autoplay.pauseOnMouseEnter&&(e.el.addEventListener("pointerenter",F),e.el.addEventListener("pointerleave",S)),getDocument().addEventListener("visibilitychange",O),v=(new Date).getTime(),f())})),t("destroy",(()=>{e.el.removeEventListener("pointerenter",F),e.el.removeEventListener("pointerleave",S),getDocument().removeEventListener("visibilitychange",O),e.autoplay.running&&b()})),t("beforeTransitionStart",((a,t,n)=>{!e.destroyed&&e.autoplay.running&&(n||!e.params.autoplay.disableOnInteraction?L(!0,!0):b())})),t("sliderFirstMove",(()=>{!e.destroyed&&e.autoplay.running&&(e.params.autoplay.disableOnInteraction?b():(l=!0,u=!1,m=!1,d=setTimeout((()=>{m=!0,u=!0,L(!0)}),200)))})),t("touchEnd",(()=>{if(!e.destroyed&&e.autoplay.running&&l){if(clearTimeout(d),clearTimeout(i),e.params.autoplay.disableOnInteraction)return u=!1,void(l=!1);u&&e.params.cssMode&&D(),u=!1,l=!1}})),t("slideChange",(()=>{!e.destroyed&&e.autoplay.running&&(y=!0)})),Object.assign(e.autoplay,{start:f,stop:b,pause:L,resume:D})}