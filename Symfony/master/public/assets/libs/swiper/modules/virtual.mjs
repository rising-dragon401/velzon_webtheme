import{g as e}from"../shared/ssr-window.esm.mjs";import{s,e as t,c as a}from"../shared/utils.mjs";function i(i){let r,{swiper:l,extendParams:d,on:n,emit:c}=i;d({virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});const o=e();l.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};const u=o.createElement("div");function p(e,s){const t=l.params.virtual;if(t.cache&&l.virtual.cache[s])return l.virtual.cache[s];let i;return t.renderSlide?(i=t.renderSlide.call(l,e,s),"string"==typeof i&&(u.innerHTML=i,i=u.children[0])):i=l.isElement?a("swiper-slide"):a("div",l.params.slideClass),i.setAttribute("data-swiper-slide-index",s),t.renderSlide||(i.innerHTML=e),t.cache&&(l.virtual.cache[s]=i),i}function h(e){const{slidesPerView:s,slidesPerGroup:a,centeredSlides:i,loop:r}=l.params,{addSlidesBefore:d,addSlidesAfter:n}=l.params.virtual,{from:o,to:u,slides:h,slidesGrid:f,offset:v}=l.virtual;l.params.cssMode||l.updateActiveIndex();const m=l.activeIndex||0;let g,x,w;g=l.rtlTranslate?"right":l.isHorizontal()?"left":"top",i?(x=Math.floor(s/2)+a+n,w=Math.floor(s/2)+a+d):(x=s+(a-1)+n,w=(r?s:a)+d);let E=m-w,b=m+x;r||(E=Math.max(E,0),b=Math.min(b,h.length-1));let S=(l.slidesGrid[E]||0)-(l.slidesGrid[0]||0);function A(){l.updateSlides(),l.updateProgress(),l.updateSlidesClasses(),c("virtualUpdate")}if(r&&m>=w?(E-=w,i||(S+=l.slidesGrid[0])):r&&m<w&&(E=-w,i&&(S+=l.slidesGrid[0])),Object.assign(l.virtual,{from:E,to:b,offset:S,slidesGrid:l.slidesGrid,slidesBefore:w,slidesAfter:x}),o===E&&u===b&&!e)return l.slidesGrid!==f&&S!==v&&l.slides.forEach((e=>{e.style[g]=S-Math.abs(l.cssOverflowAdjustment())+"px"})),l.updateProgress(),void c("virtualUpdate");if(l.params.virtual.renderExternal)return l.params.virtual.renderExternal.call(l,{offset:S,from:E,to:b,slides:function(){const e=[];for(let s=E;s<=b;s+=1)e.push(h[s]);return e}()}),void(l.params.virtual.renderExternalUpdate?A():c("virtualUpdate"));const M=[],y=[],j=e=>{let s=e;return e<0?s=h.length+e:s>=h.length&&(s-=h.length),s};if(e)l.slides.filter((e=>e.matches(`.${l.params.slideClass}, swiper-slide`))).forEach((e=>{e.remove()}));else for(let e=o;e<=u;e+=1)if(e<E||e>b){const s=j(e);l.slides.filter((e=>e.matches(`.${l.params.slideClass}[data-swiper-slide-index="${s}"], swiper-slide[data-swiper-slide-index="${s}"]`))).forEach((e=>{e.remove()}))}const G=r?-h.length:0,P=r?2*h.length:h.length;for(let s=G;s<P;s+=1)if(s>=E&&s<=b){const t=j(s);void 0===u||e?y.push(t):(s>u&&y.push(t),s<o&&M.push(t))}if(y.forEach((e=>{l.slidesEl.append(p(h[e],e))})),r)for(let e=M.length-1;e>=0;e-=1){const s=M[e];l.slidesEl.prepend(p(h[s],s))}else M.sort(((e,s)=>s-e)),M.forEach((e=>{l.slidesEl.prepend(p(h[e],e))}));t(l.slidesEl,".swiper-slide, swiper-slide").forEach((e=>{e.style[g]=S-Math.abs(l.cssOverflowAdjustment())+"px"})),A()}n("beforeInit",(()=>{if(!l.params.virtual.enabled)return;let e;if(void 0===l.passedParams.virtual.slides){const s=[...l.slidesEl.children].filter((e=>e.matches(`.${l.params.slideClass}, swiper-slide`)));s&&s.length&&(l.virtual.slides=[...s],e=!0,s.forEach(((e,s)=>{e.setAttribute("data-swiper-slide-index",s),l.virtual.cache[s]=e,e.remove()})))}e||(l.virtual.slides=l.params.virtual.slides),l.classNames.push(`${l.params.containerModifierClass}virtual`),l.params.watchSlidesProgress=!0,l.originalParams.watchSlidesProgress=!0,h()})),n("setTranslate",(()=>{l.params.virtual.enabled&&(l.params.cssMode&&!l._immediateVirtual?(clearTimeout(r),r=setTimeout((()=>{h()}),100)):h())})),n("init update resize",(()=>{l.params.virtual.enabled&&l.params.cssMode&&s(l.wrapperEl,"--swiper-virtual-size",`${l.virtualSize}px`)})),Object.assign(l.virtual,{appendSlide:function(e){if("object"==typeof e&&"length"in e)for(let s=0;s<e.length;s+=1)e[s]&&l.virtual.slides.push(e[s]);else l.virtual.slides.push(e);h(!0)},prependSlide:function(e){const s=l.activeIndex;let t=s+1,a=1;if(Array.isArray(e)){for(let s=0;s<e.length;s+=1)e[s]&&l.virtual.slides.unshift(e[s]);t=s+e.length,a=e.length}else l.virtual.slides.unshift(e);if(l.params.virtual.cache){const e=l.virtual.cache,s={};Object.keys(e).forEach((t=>{const i=e[t],r=i.getAttribute("data-swiper-slide-index");r&&i.setAttribute("data-swiper-slide-index",parseInt(r,10)+a),s[parseInt(t,10)+a]=i})),l.virtual.cache=s}h(!0),l.slideTo(t,0)},removeSlide:function(e){if(null==e)return;let s=l.activeIndex;if(Array.isArray(e))for(let t=e.length-1;t>=0;t-=1)l.params.virtual.cache&&(delete l.virtual.cache[e[t]],Object.keys(l.virtual.cache).forEach((s=>{s>e&&(l.virtual.cache[s-1]=l.virtual.cache[s],l.virtual.cache[s-1].setAttribute("data-swiper-slide-index",s-1),delete l.virtual.cache[s])}))),l.virtual.slides.splice(e[t],1),e[t]<s&&(s-=1),s=Math.max(s,0);else l.params.virtual.cache&&(delete l.virtual.cache[e],Object.keys(l.virtual.cache).forEach((s=>{s>e&&(l.virtual.cache[s-1]=l.virtual.cache[s],l.virtual.cache[s-1].setAttribute("data-swiper-slide-index",s-1),delete l.virtual.cache[s])}))),l.virtual.slides.splice(e,1),e<s&&(s-=1),s=Math.max(s,0);h(!0),l.slideTo(s,0)},removeAllSlides:function(){l.virtual.slides=[],l.params.virtual.cache&&(l.virtual.cache={}),h(!0),l.slideTo(0,0)},update:h})}export{i as default};